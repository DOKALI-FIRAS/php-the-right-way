---
title: Composer و Packagist
isChild: false
isChild: true
anchor:  composer_and_packagist
---

## Composer و Packagist {#composer_and_packagist_title}

يعتبر Composer أداة **ممتازة** لإدارة توابع لغة PHP. كل ما عليك هو أن تضع قائمة بالتوابع في ملف `composer.json` وببعض أوامر
سهلة سيقوم Composer بتنزيل كل توابع مشروعك بالإضافة لتنصيب وضبط ملف إدراج تلقائي autoload.
يعتبر Composer مماثل لـ NPM المستخدم في node.js، أو Bundler المستخدم في Ruby.

يوجد الكثير من مكتبات لغة PHP متوافقة مع Composer وجاهزة للاستخدام مع مشروعك. هذه المكتبات أو «الحزم» مدرجة في [Packagist]، المستودع الحصري لكل مكتبات لغة PHP المتوافقة مع Composer.

### كيفية تنصيب Composer

الطريقة الآمنة لتحميل Composer هي عن طريق [التعليمات الرسمية](https://getcomposer.org/download/).
سيتم التحقق من ملفات التنصيب كونها سليمة ولم يتم التلاعب بها.
يقوم ملف التنصيب بتنصيب Composer *محلياً* في مجلد العمل الحالي.

ننصح بتنصيبه *للإتاحة العامة* (مثلا نسخة واحدة في `/usr/local/bin`)، للقيام بذلك قم بتنفيذ:

{% highlight console %}
mv composer.phar /usr/local/bin/composer
{% endhighlight %}

**ملاحظة:** إذا فشل الأمر السابق بسبب صلاحيات قم بتشغيل الأمر `mv` مرة أخرى بكتابة الأمر `sudo` قبله.

لتشغيل Composer الذي تم تنصيبه محلياً قم باستخدام `php composer.phar` وعامةً قم باستخدام `composer` فقط.

#### التنصيب على نظام تشغيل Windows

بالنسبة لمستخدمي نظام التشغيل Windows الطريقة الأسهل هي استخدام ملف تنصيب [ComposerSetup]، حيث يقوم بتنصيبه بشكل عام على النظام، ويقوم بضبط متغيرات `$PATH` حتى تتمكن من استدعاء الأمر `composer` فقط من شاشة سطور الأوامر من أي مجلد في النظام.

### كيفية تنصيب Composer (يدوياً)

تنصيب Composer يدوياً هو عملية متقدمة، لذلك هناك العديد من الأسباب تجعل المُطَوِّر يقوم باستخدام هذه الطريقة بدلاً عن الطريقة التلقائية التقليدية. فالطريقة التقليدية التلقائية تقوم بفحص إصدار PHP الحالي لتقوم بالتَّأكد من الآتي:

- توافق إصدار PHP المنصب حالياً.
- هل يمكن تشغيل وتنفيذ ملفات `.phar` بصورة صحيحة.
- التأكد من الصلاحيات على المجلدات.
- التأكد من الملحقات إذا فشل إدراجها.
- التأكد من ملف الضبط `php.ini`.

في المقابل الطريقة التقليدية لا تقوم بأي من العمليات المذكورة آنفاً، يتوجب عليك أن تقوم ببعض أو كل العمليات يدوياً، لتنصيب Composer يدويا قم بالآتي:

{% highlight console %}
curl -s https://getcomposer.org/composer.phar -o $HOME/local/bin/composer
chmod +x $HOME/local/bin/composer
{% endhighlight %}

المجلد `$HOME/local/bin` (أو المجلد الذي تختاره) يجب أن يكون مُدْرَجًا في متغيرات `$PATH`. وهكذا يمكن الوصول إلى الأمر `composer` من أي مكان (في نظام التشغيل).

عند استخدام طريقة اليدوية ستتغير طريقة الاستخدام التي قد تجدها في بعض المراجع `php composer.phar install` ليكتب بدلاً منها الآتي:

{% highlight console %}
composer install
{% endhighlight %}

في القسم التالي سوف نفترض أنك قمت بتنصيب Composer بشكل عام في النظام.

### كيفية تحديد وإدراج التوابع

يقوم Composer بتتبع وإدارة توابع مشروعك عن طريق ملف يسمى `composer.json`. يمكنك إدارة هذا الملف يدوياً باستخدام أي محرر نصوص، أو استخدام Composer لإنجاز هذه العملية. يقوم الأمر `composer require` بإضافة تابع إلى مشروعك، فإذا لم يكن ملف `composer.json` موجوداً سيقوم تلقائياً بإنشائه.
مثال لإدراج مكتبة [Twig] كتابع لمشروعك.

{% highlight console %}
composer require twig/twig:~1.8
{% endhighlight %}

عوضاً عن ذلك يمكنك تنفيذ الأمر `composer init` الذي سيساعدك لإنشاء ملف `composer.json` بالكامل ليتناسب مع مشروعك. ويمكنك أيضاً بعد إنشاء ملف `composer.json` أن تُخْبِر Composer بأن يقوم بتحميل وتنصيب التوابع في مجلد `vendor/`. وهذا ينطبق أيضاً على المشاريع والمكتبات التي تقوم بتنزيلها ويوجد معها الملف `composer.json`.

{% highlight console %}
composer install
{% endhighlight %}

بعدها، قم بإضافة هذا السطر إلى ملف برنامجك الأساسي، حتى يتمكن من إعلام PHP لتستخدم المدرج التلقائي autoloader التابع لـ Composer ليدرج التوابع لمشروعك.

{% highlight php %}
<?php
require 'vendor/autoload.php';
{% endhighlight %}

يمكنك الآن استخدام توابع مشروعك وسيتم إدراجها تلقائياً باستخدام autoloader.

### تحديث التوابع

يقوم Composer بإنشاء ملف باسم `composer.lock` حيث يقوم بحفظ أرقام إصدارات كل تابع يقوم بتحميله عند تنفيذ الأمر `composer install` أول مرة. إذا كنت تشارك مشروعك مع مطورين آخرين وملف `composer.lock` هو جزء من ملفاتك، فعندما يقوم أحدهم بتنفيذ الأمر `composer install` سوف يحصل على نفس الإصدارات الموجودة لديك.
لتحديث التوابع قم بتنفيذ الأمر `composer update`. لا تقم بالتحديث عند التركيب على بيئة العمل النهائية، ولكن قم بالتنصيب باستخدام `composer install` وإلا سينتهي بك المطاف بأن يكون هناك اختلاف في إصدارات الحزم.

تكون هذه العملية مفيدة عندما تكون متطلباتك من التوابع محددة بمرونة، فمثلا تتطلب لمشروعك تابع بالإصدار `~1.8` بمعنى «كل الإصدارات الأحدث من 1.8.0، والأقل من 2.0.x-dev». يمكنك أيضاً استخدام `*` `1.8.*` لتحديد الكل من خانة واحدة.
فالآن عند تنفيذ الأمر `composer update` سيقوم Composer بتحديث كل توابعك إلى النسخة الأحدث بناءً على ما قد حَدَّدته سلفاً كمطلب.

### تنبيهات التحديثات

لكي تصل إليك تنبيهات عند صدور إصدارات جديدة من التوابع يمكنك التسجيل في [VersionEye]، وهي خدمة يمكنها متابعة حسابك في كل من
GitHub و BitBucket للبحث داخل ملفات `composer.json`، وتقوم بإرسال بريد إلكتروني عند صدور تحديثات جديدة.

### فحص مشاكل الأمان في توابعك

[Security Advisories Checker] هي خدمة وأداة تعمل على سطور الأوامر، حيث تقوم باختبار ملف `composer.lock` وتقوم بإخبارك إذا ما كان هنالك حاجة لتحديث أي من التوابع.

### التحكم في التوابع العامة باستخدام Composer

يمكن لـ Composer التَّحكم في التوابع وملفاتها التنفيذية أيضاً. طريقة الاستخدام واضحة جداً، كل ما عليك فعله هو إدراج كلمة `global`
قبل تنفيذ الأمر. مثلا إذا كنت تريد تنصيب الأداة PHPUnit واستخدامها بشكل عام في نظامك قم بتنفيذ هذا الأمر:

{% highlight console %}
composer global require phpunit/phpunit
{% endhighlight %}

هذا الأمر سيقوم بإنشاء مجلد في `~/.composer` حيث يقوم بوضع كل التوابع العامة هناك. ولكي تقوم بتنفيذ أوامر وعمليات تلك التوابع
من أي مكان، قم بإدراج مسار المجلد `~/.composer/vendor/bin` إلى متغير `$PATH` في النظام لديك.

* [تعرف على المزيد عن Composer]

[Packagist]: http://packagist.org/
[Twig]: http://twig.sensiolabs.org
[VersionEye]: https://www.versioneye.com/
[Security Advisories Checker]: https://security.sensiolabs.org/
[Learn about Composer]: http://getcomposer.org/doc/00-intro.md
[ComposerSetup]: https://getcomposer.org/Composer-Setup.exe
